# GameState Schema

This document defines the stable simulation state for Fairview. All numeric fields are 0-100 unless noted.

## Top-Level

- `seed` (number): Seed used for deterministic RNG.
- `scenarioKey` (string): Scenario preset key from `SCENARIOS`.
- `turn` (number): Current turn index.
- `year` (number): Current year index.
- `stage` (number): Current development stage (1-4).
- `baseBudget` (number): Base budget before growth/tax adjustments.
- `budget` (number): Available budget this turn (0-200).
- `districts[]` (array): Grid districts, see below.
- `groups` (object): Population group outcomes, see below.
- `institutions` (object): Institutional levers, see below.
- `tokens[]` (array): Placed institution tokens with `type`, `x`, `y`.
- `placementsThisTurn` (number): Token placements used this turn.
- `shocks` (object): Short-term adjustments applied on reset.
- `pendingEffects[]` (array): Delayed policy effects.
- `metrics` (object): City-wide metrics, see below.
- `lastEventCategory` (string|null): Category of the most recent event.
- `news[]` (array): Newsfeed entries (structured objects with `kind`, `turn`, and payload).
- `history[]` (array): Per-turn record of metrics and group outcomes.
- `stageTransitions[]` (array): Stage changes `{turn, stage, unlocked}`.
- `lastMetricDeltas` (object): Metric deltas from last turn.
- `lastGroupDeltas` (object): Group deltas from last turn.
- `lastDistrictDeltas` (object): District deltas from last turn.
- `lastDistrictDrivers` (object): Why-did-it-change strings for inspector.
- `lastHousingDelta` (number): Average housing cost change per turn.
- `lastSummary` (object): Turn summary used by the modal.
- `lastStageChange` (object): Details of the most recent stage transition.
- `lastQuoteTurn` (number): Turn when the last civic quote was added.
- `bureaucracyCount` (number): Count of bureaucracy events.
- `endgame` (object|null): Endgame payload `{turn, achievements}`.
- `achievements[]` (array): Achievements unlocked at endgame.
- `crisisStreak` (number): Consecutive turns of growth-capacity mismatch.
- `activeCrisis` (object|null): Active crisis with `turnsLeft`.

## Metrics (0-100)

Computed in `computeMetrics(state)` in `engine.js`.

- `growth`: Economic and population expansion index.
- `strain`: Pressure generated by growth and inequality.
- `legitimacy`: Trust in institutions and social order.
- `cohesion`: Social integration and shared norms.
- `capacity`: Average institutional readiness.
- `inequality`: Income and spatial stratification.
- `disorder`: Social instability and disruption.
- `resilience`: Ability to absorb shocks.
- `mobility`: Likelihood of upward movement.
- `capture`: Elite influence over policy.
- `burden`: Concentrated harm on vulnerable groups.
- `contestation`: Protest and conflict risk.

## Districts

Computed in `computeDistricts(state)` in `engine.js`.

Each district has:

- `id` (number)
- `x`, `y` (number): Grid coordinates.
- `populationValue` (0-100): Density proxy.
- `incomeTier` (0=Low, 1=Middle, 2=High).
- `housingCost` (0-100): Cost index.
- `cohesion` (0-100): Local integration.
- `access` (0-100): Institutional access index.
- `risk` (0-100): Exposure to harm.
- `devLevel` (1-3): Visual development tier.
- `tokens[]` (array): Token types placed here.
- `nickname` (string|null): District nickname if assigned.
- `nicknameCategory` (string|null): Nickname category.
- `lastDrivers[]` (array): Top drivers for changes.

## Groups

Computed in `computeGroupOutcomes(state)` in `engine.js`.

Each group contains:

- `income` (0-100)
- `wellbeing` (0-100)
- `influence` (0-100)
- `grievance` (0-100)

## Institutions

Institution levers are stored at `state.institutions[inst].levers`.

Examples:

- `economy.levers.wage`
- `economy.levers.tax`
- `polity.levers.voting`
- `education.levers.funding`

## Pending Effects

`pendingEffects[]` stores delayed policy effects:

- `turns` (number): turns remaining
- `effect` (object): same shape as policy effects

## Shocks

`shocks` are short-term offsets used when resetting budget or metrics.

- Includes `budget` which can be positive or negative.

## Computation Map

- `computeMetrics(state)` derives city metrics.
- `computeDistricts(state)` updates districts using metrics and tokens.
- `computeGroupOutcomes(state)` updates groups using metrics and district averages.
- `step(state, rng, actions)` runs the full turn loop.
